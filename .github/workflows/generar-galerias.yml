name: Generar galerías automáticamente (Domingos y Miércoles)

on:
  push:
    paths:
      - "fotos/**"
      - "videos/**"

jobs:
  generar-galerias:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v4

      # =========================
      # DOMINGOS - FOTOS
      # =========================
      - name: Generar fotos.js para DOMINGOS
        run: |
          find fotos -type d -path "*DOMINGOS/*" | while read dir; do
            if ls "$dir"/*.jpg 1> /dev/null 2>&1; then
              echo "Generando fotos.js en $dir"
              echo "const fotos = [" > "$dir/fotos.js"
              for file in "$dir"/*.jpg; do
                name=$(basename "$file")
                echo "  \"$name\"," >> "$dir/fotos.js"
              done
              echo "];" >> "$dir/fotos.js"
            fi
          done

      # =========================
      # MIÉRCOLES - FOTOS
      # =========================
      - name: Generar fotos.js para MIERCOLES
        run: |
          find fotos -type d -path "*MIERCOLES/*" | while read dir; do
            if ls "$dir"/*.jpg 1> /dev/null 2>&1; then
              echo "Generando fotos.js en $dir"
              echo "const fotos = [" > "$dir/fotos.js"
              for file in "$dir"/*.jpg; do
                name=$(basename "$file")
                echo "  \"$name\"," >> "$dir/fotos.js"
              done
              echo "];" >> "$dir/fotos.js"
            fi
          done

      # =========================
      # COMMIT AUTOMÁTICO
      # =========================
      - name: Commit automático
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add fotos/**/fotos.js
          git commit -m "Actualizar galerías automáticamente" || echo "Sin cambios"
          git push
